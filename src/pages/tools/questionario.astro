--- 
import Layout from '../../layouts/Layout.astro';

export const title = "Gerenciador de Questionários";
export const description = "Crie, aplique e analise avaliações com correção automática e relatórios detalhados.";
export const status = "Beta";
export const docsLink = "#"; 
export const repoLink = "#";
export const aecJourney = ["Escritório", "Canteiro"];
---

<Layout title={title} description={description}>
    <!-- Bibliotecas JS necessárias -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <div id="app-container" class="tool-wrapper">
        <div class="header-section">
            <h1 class="main-title">Gerenciador de Avaliações</h1>
            <p class="subtitle">Cole seu questionário em Markdown, responda e gere relatórios.</p>
        </div>

        <!-- 1. Módulo de Configuração/Input -->
        <section id="config-module" class="content-box">
            <h2 class="box-title">1. Entrada do Questionário</h2>
            
            <div class="toolbar">
                <p class="instruction-text">Cole o texto abaixo ou use o modelo padrão.</p>
                <button id="load-template-btn" class="btn btn-info text-sm">Carregar Template</button>
            </div>

            <textarea id="markdown-input" class="input-area" placeholder="Cole seu Markdown aqui..."></textarea>

            <button id="load-quiz-btn" class="btn btn-primary btn-full mt-4" disabled>Iniciar Questionário</button>
        </section>

        <!-- 2. Módulo de Questionário -->
        <section id="quiz-module" class="content-box hidden">
            <h2 id="quiz-discipline-title" class="box-title text-primary"></h2>
            
            <div id="questions-list">
                <!-- Questões renderizadas via JS -->
            </div>

            <div id="quiz-status" class="status-bar"></div>

            <button id="finish-quiz-btn" class="btn btn-success btn-full mt-4">Finalizar e Ver Resultados</button>
        </section>

        <!-- 3. Módulo de Resultados -->
        <section id="results-module" class="content-box hidden">
            <h2 class="box-title text-center">Dashboard de Resultados</h2>

            <!-- Botões de Controle -->
            <div class="action-buttons-row">
                <button id="export-pdf-btn" class="btn btn-danger flex-btn">
                    <i class="fas fa-file-pdf"></i> Exportar PDF
                </button>
                <button id="export-png-btn" class="btn btn-info flex-btn">
                    <i class="fas fa-image"></i> Exportar PNG
                </button>
                <button id="reset-app-btn" class="btn btn-secondary flex-btn">
                    <i class="fas fa-redo"></i> Novo Questionário
                </button>
            </div>

            <!-- Área de Dashboard -->
            <div id="dashboard-content">
                <!-- Sumário -->
                <div id="results-summary" class="summary-grid"></div>

                <!-- Gráficos -->
                <div id="report-charts" class="charts-grid">
                    <div class="chart-box">
                        <h3>Desempenho por Disciplina</h3>
                        <div class="canvas-wrapper"><canvas id="discipline-chart"></canvas></div>
                    </div>
                    <div class="chart-box">
                        <h3>Distribuição Global</h3>
                        <div class="canvas-wrapper"><canvas id="global-chart"></canvas></div>
                    </div>
                </div>

                <!-- Detalhes -->
                <div id="discipline-details" class="mt-8">
                    <h3>Detalhes por Questão</h3>
                    <!-- Gráficos de detalhe via JS -->
                </div>
            </div>
            
            <!-- Gabarito -->
            <div id="answer-review" class="mt-12">
                <h3 class="section-subtitle">Gabarito e Revisão</h3>
                <div id="gabarito-table-container" class="table-wrapper"></div>
            </div>
        </section>

        <!-- Mensagens Flutuantes -->
        <div id="message-box" class="toast hidden"></div>

        <!-- Modal IA -->
        <div id="gemini-modal" class="modal-overlay hidden">
            <div class="modal-card">
                <button id="gemini-modal-close" class="modal-close">&times;</button>
                <h3 class="modal-title">✨ Análise da Questão</h3>
                
                <div id="gemini-loading" class="loading-state">
                    <div class="spinner"></div>
                    <p>Consultando tutor IA...</p>
                </div>

                <div id="gemini-modal-content" class="modal-body hidden"></div>
            </div>
        </div>
    </div>

    <script is:inline>
        // =========================================================================
        // LÓGICA DA APLICAÇÃO (Adaptada para usar novas classes CSS)
        // =========================================================================
        const APP = {};

        APP.state = {
            quizData: null,
            userAnswers: {},
            chartInstances: []
        };

        // --- 1. PARSER (Mantido praticamente igual) ---
        APP.MARKDOWN_PARSER = {
            parse: function(markdownText) {
                if (!markdownText) return null;
                const lines = markdownText.split('\n').map(line => line.trim()).filter(l => l.length > 0);
                const data = { disciplines: [], gabarito: {} };
                let currentDiscipline = null;
                let currentQuestion = null;
                let isGabaritoSection = false;
                let uniqueIdCounter = 1;

                const regexDiscipline = /^##\s*Disciplina:\s*(.*)/i;
                const regexQuestionTitle = /^###\s*Questão\s*(\d+):\s*(.*)/i;
                const regexText = /^(\**Texto:\**)\s*(.*)/i;
                const regexEnunciated = /^(\**Enunciado:\**)\s*(.*)/i;
                const regexOption = /^- ([A-Za-z]\.)\s*(.*)/;
                const regexGabaritoHeader = /^##\s*Gabarito/i;
                const regexGabaritoSectionHeader = /^(###|####)\s*([A-Za-zÀ-ÿ\s]+)/i;
                const regexGabaritoAnswer = /^(###|####|#####)\s*Questão\s*(\d+):\s*([A-Za-z])/i; 

                let currentGabaritoDiscipline = null;
                const gabaritoAnswersMap = {}; 

                for (const line of lines) {
                    if (regexGabaritoHeader.test(line)) { isGabaritoSection = true; continue; }

                    if (isGabaritoSection) {
                        const disciplineHeaderMatch = line.match(regexGabaritoSectionHeader); 
                        if (disciplineHeaderMatch && !line.includes('Questão')) {
                            currentGabaritoDiscipline = disciplineHeaderMatch[2].trim();
                            continue;
                        }
                        const gabaritoAnswerMatch = line.match(regexGabaritoAnswer);
                        if (gabaritoAnswerMatch && currentGabaritoDiscipline) {
                            const uniqueKey = `${currentGabaritoDiscipline}_${gabaritoAnswerMatch[2]}`; 
                            gabaritoAnswersMap[uniqueKey] = gabaritoAnswerMatch[3].toUpperCase();
                        }
                    } else {
                        const disciplineMatch = line.match(regexDiscipline);
                        if (disciplineMatch) {
                            currentDiscipline = { name: disciplineMatch[1].trim(), questions: [] };
                            data.disciplines.push(currentDiscipline);
                            currentQuestion = null;
                            continue;
                        }
                        const questionMatch = line.match(regexQuestionTitle);
                        if (questionMatch) {
                            if (!currentDiscipline) throw new Error("Disciplina não definida antes da questão.");
                            currentQuestion = {
                                internalId: String(uniqueIdCounter++),
                                displayNum: questionMatch[1],
                                title: questionMatch[2].trim(),
                                enunciated: '', text: '', options: [],
                                discipline: currentDiscipline.name,
                            };
                            currentDiscipline.questions.push(currentQuestion);
                            continue;
                        }
                        if (currentQuestion) {
                            const textMatch = line.match(regexText);
                            const enunciatedMatch = line.match(regexEnunciated);
                            const optionMatch = line.match(regexOption);
                            
                            if (textMatch) currentQuestion.text = textMatch[2].trim();
                            else if (enunciatedMatch) currentQuestion.enunciated = enunciatedMatch[2].trim();
                            else if (optionMatch) {
                                currentQuestion.options.push({ id: optionMatch[1].replace('.', '').toUpperCase(), text: optionMatch[2].trim() });
                            } else {
                                if (currentQuestion.text && !currentQuestion.options.length) currentQuestion.text += ' ' + line.trim();
                                else if (currentQuestion.enunciated) currentQuestion.enunciated += ' ' + line.trim();
                            }
                        }
                    }
                }

                data.disciplines.forEach(disc => {
                    disc.questions.forEach(q => {
                        const uniqueKey = `${disc.name}_${q.displayNum}`;
                        if (gabaritoAnswersMap[uniqueKey]) data.gabarito[q.internalId] = gabaritoAnswersMap[uniqueKey]; 
                    });
                });

                return data;
            }
        };

        // --- 2. MANAGER (Mantido) ---
        APP.QUIZ_MANAGER = {
            loadQuiz: function() {
                const markdownText = document.getElementById('markdown-input').value;
                const loadBtn = document.getElementById('load-quiz-btn');
                if (!markdownText.trim()) return APP.UI_RENDERER.showMessage('Insira o texto do questionário.', 'danger');

                loadBtn.disabled = true;
                loadBtn.textContent = 'Processando...';

                try {
                    APP.state.quizData = APP.MARKDOWN_PARSER.parse(markdownText);
                    APP.state.userAnswers = {};
                    APP.UI_RENDERER.renderQuizView();
                    APP.UI_RENDERER.showMessage('Questionário carregado!', 'success');
                } catch (error) {
                    APP.UI_RENDERER.showMessage('Erro: ' + error.message, 'danger');
                } finally {
                    loadBtn.disabled = false;
                    loadBtn.textContent = 'Iniciar Questionário';
                }
            },
            saveAnswer: function(qid, aid) {
                APP.state.userAnswers[qid] = aid;
                APP.QUIZ_MANAGER.updateStatus();
            },
            updateStatus: function() {
                const total = APP.QUIZ_MANAGER.getTotalQuestionsCount();
                const answered = Object.keys(APP.state.userAnswers).length;
                document.getElementById('quiz-status').innerHTML = `Progresso: <strong>${answered}</strong> de <strong>${total}</strong> respondidas.`;
            },
            getTotalQuestionsCount: function() {
                return APP.state.quizData ? APP.state.quizData.disciplines.reduce((acc, d) => acc + d.questions.length, 0) : 0;
            },
            finishQuiz: function() {
                APP.UI_RENDERER.renderResultsView(APP.QUIZ_MANAGER.calculateResults());
            },
            calculateResults: function() {
                const gabarito = APP.state.quizData.gabarito;
                const results = { totalCorrect: 0, totalIncorrect: 0, totalUnanswered: 0, totalQuestions: APP.QUIZ_MANAGER.getTotalQuestionsCount(), disciplineStats: {}, questionReview: [] };

                APP.state.quizData.disciplines.forEach(disc => {
                    const discStats = { correct: 0, incorrect: 0, unanswered: 0, total: disc.questions.length, questionDetails: {} };
                    disc.questions.forEach(q => {
                        const internalId = q.internalId;
                        const ua = APP.state.userAnswers[internalId];
                        const ca = gabarito[internalId];
                        let status;

                        if (ua === undefined) { discStats.unanswered++; results.totalUnanswered++; status = 'unanswered'; }
                        else if (ua === ca) { discStats.correct++; results.totalCorrect++; status = 'correct'; }
                        else { discStats.incorrect++; results.totalIncorrect++; status = 'incorrect'; }
                        
                        discStats.questionDetails[internalId] = status;
                        results.questionReview.push({ internalId: internalId, displayNum: q.displayNum, discipline: disc.name, userAnswer: ua || '-', correctAnswer: ca, status: status });
                    });
                    results.disciplineStats[disc.name] = discStats;
                });
                return results;
            }
        };

        // --- 3. RENDERER (Atualizado para usar classes CSS Customizadas) ---
        APP.UI_RENDERER = {
            renderQuizView: function() {
                document.getElementById('config-module').classList.add('hidden');
                document.getElementById('quiz-module').classList.remove('hidden');
                const qList = document.getElementById('questions-list');
                qList.innerHTML = '';

                APP.state.quizData.disciplines.forEach(disc => {
                    const discHeader = document.createElement('div');
                    discHeader.className = 'discipline-header';
                    discHeader.innerHTML = `<h3>${disc.name}</h3>`;
                    qList.appendChild(discHeader);

                    disc.questions.forEach(q => qList.appendChild(APP.UI_RENDERER.createQuestionCard(q)));
                });
                APP.QUIZ_MANAGER.updateStatus();
            },

            createQuestionCard: function(question) {
                const card = document.createElement('div');
                card.id = `q-${question.internalId}`;
                card.className = 'question-card'; // Classe CSS nativa

                let html = `<div class="question-title">Questão ${question.displayNum}: ${question.title}</div>`;
                if (question.text) html += `<div class="question-support-text"><strong>Texto:</strong> ${question.text}</div>`;
                html += `<p class="question-enunciated">${question.enunciated}</p><div class="options-container">`;

                question.options.forEach(opt => {
                    const optionId = `q${question.internalId}_opt${opt.id}`;
                    const radioName = `q${question.internalId}`;
                    const isChecked = APP.state.userAnswers[question.internalId] === opt.id ? 'checked' : '';

                    html += `
                        <div class="option-item">
                            <input type="radio" id="${optionId}" name="${radioName}" value="${opt.id}" ${isChecked} 
                                   onchange="APP.QUIZ_MANAGER.saveAnswer('${question.internalId}', '${opt.id}')">
                            <label for="${optionId}" class="option-label">
                                <span class="opt-id">${opt.id}</span>
                                <span class="opt-text">${opt.text}</span>
                            </label>
                        </div>
                    `;
                });
                html += '</div>';
                card.innerHTML = html;
                return card;
            },

            renderResultsView: function(results) {
                document.getElementById('quiz-module').classList.add('hidden');
                document.getElementById('results-module').classList.remove('hidden');
                
                // Renderiza Resumo
                document.getElementById('results-summary').innerHTML = `
                    <div class="summary-card bg-primary-light">
                        <div class="val">${results.totalQuestions}</div>
                        <div class="lbl">Questões</div>
                    </div>
                    <div class="summary-card bg-success-light">
                        <div class="val">${results.totalCorrect}</div>
                        <div class="lbl">Acertos</div>
                    </div>
                    <div class="summary-card bg-danger-light">
                        <div class="val">${results.totalIncorrect + results.totalUnanswered}</div>
                        <div class="lbl">Erros</div>
                    </div>
                `;

                APP.REPORT_GENERATOR.destroyCharts();
                APP.REPORT_GENERATOR.renderCharts(results);

                // Feedback Visual nas Questões (Classes CSS)
                const qList = document.getElementById('questions-list');
                qList.querySelectorAll('input').forEach(i => i.disabled = true);
                
                APP.state.quizData.disciplines.forEach(disc => {
                    disc.questions.forEach(q => {
                        const card = document.getElementById(`q-${q.internalId}`);
                        if (!card) return;
                        const ua = APP.state.userAnswers[q.internalId];
                        const ca = APP.state.quizData.gabarito[q.internalId];
                        
                        card.classList.add(ua === ca ? 'status-correct' : 'status-incorrect');

                        card.querySelectorAll('.option-item').forEach(item => {
                            const input = item.querySelector('input');
                            const label = item.querySelector('label');
                            const optId = label.querySelector('.opt-id').textContent.trim();

                            if (optId === ca) {
                                label.classList.add('is-correct');
                                label.innerHTML += ` <span class="badge-correct">(Gabarito)</span>`;
                            }
                            if (ua && optId === ua) {
                                label.classList.add('is-selected');
                                if (ua !== ca) label.innerHTML += ` <span class="badge-wrong">(Sua Resposta)</span>`;
                            }
                        });
                    });
                });

                APP.UI_RENDERER.renderAnswerReviewTable(results.questionReview);
                
                // Move a lista de questões revisadas para o final
                const reviewContainer = document.getElementById('answer-review');
                const oldTitle = reviewContainer.querySelector('.review-title');
                if(oldTitle) oldTitle.remove();
                const title = document.createElement('h3');
                title.className = 'review-title section-subtitle mt-8';
                title.textContent = 'Revisão Detalhada';
                reviewContainer.appendChild(title);
                reviewContainer.appendChild(qList);
            },

            renderAnswerReviewTable: function(list) {
                const container = document.getElementById('gabarito-table-container');
                let html = `<table class="result-table"><thead><tr>
                    <th>#</th><th>Disciplina</th><th>Sua Resp.</th><th>Gabarito</th><th>Ação</th>
                </tr></thead><tbody>`;

                list.forEach(r => {
                    let action = '-';
                    if (r.status === 'incorrect') {
                        action = `<button class="btn-xs btn-info" onclick="APP.GEMINI_HELPER.explain('${r.internalId}')">Explicar Erro</button>`;
                    }
                    html += `<tr>
                        <td>${r.displayNum}</td>
                        <td>${r.discipline}</td>
                        <td class="${r.status === 'correct' ? 'text-success' : 'text-danger'} bold">${r.userAnswer}</td>
                        <td class="text-success bold">${r.correctAnswer}</td>
                        <td>${action}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                container.innerHTML = html;
            },

            showMessage: function(msg, type = 'info') {
                const box = document.getElementById('message-box');
                box.textContent = msg;
                box.className = `toast toast-${type} show`;
                setTimeout(() => box.classList.remove('show'), 3000);
            },

            resetApp: function() {
                // Restaura lista de questões para o módulo de quiz
                const qList = document.getElementById('questions-list');
                const qModule = document.getElementById('quiz-module');
                qModule.insertBefore(qList, document.getElementById('quiz-status'));

                document.getElementById('markdown-input').value = '';
                document.getElementById('config-module').classList.add('hidden');
                document.getElementById('quiz-module').classList.add('hidden');
                document.getElementById('results-module').classList.add('hidden');
                APP.state.quizData = null;
                APP.state.userAnswers = {};
                APP.REPORT_GENERATOR.destroyCharts();
                document.getElementById('gabarito-table-container').innerHTML = '';
            },

            insertTemplate: function() {
                const tpl = `## Disciplina: Exemplo\n### Questão 1: Teste\n**Enunciado:** Quanto é 1+1?\n- A. 1\n- B. 2\n- C. 3\n## Gabarito\n### Exemplo\n#### Questão 1: B`;
                document.getElementById('markdown-input').value = tpl;
                document.getElementById('load-quiz-btn').disabled = false;
            }
        };

        // --- 4. CHARTS & EXPORT ---
        APP.REPORT_GENERATOR = {
            destroyCharts: function() {
                APP.state.chartInstances.forEach(c => c.destroy());
                APP.state.chartInstances = [];
                document.getElementById('discipline-details').innerHTML = '<h3>Detalhes por Questão</h3>';
            },
            renderCharts: function(results) {
                // Implementação simplificada dos gráficos Chart.js
                const ctxGlobal = document.getElementById('global-chart').getContext('2d');
                APP.state.chartInstances.push(new Chart(ctxGlobal, {
                    type: 'doughnut',
                    data: {
                        labels: ['Acertos', 'Erros'],
                        datasets: [{ data: [results.totalCorrect, results.totalIncorrect + results.totalUnanswered], backgroundColor: ['#10b981', '#ef4444'] }]
                    }
                }));

                const discNames = Object.keys(results.disciplineStats);
                const ctxDisc = document.getElementById('discipline-chart').getContext('2d');
                APP.state.chartInstances.push(new Chart(ctxDisc, {
                    type: 'bar',
                    data: {
                        labels: discNames,
                        datasets: [{ 
                            label: '% Acerto', 
                            data: discNames.map(d => (results.disciplineStats[d].correct / results.disciplineStats[d].total)*100),
                            backgroundColor: '#4f46e5'
                        }]
                    },
                    options: { scales: { y: { beginAtZero: true, max: 100 } } }
                }));
            },
            exportReport: async function(fmt) {
                // Lógica de exportação simplificada para usar classes nativas
                APP.UI_RENDERER.showMessage('Exportação iniciada...', 'info');
                // ... (Lógica similar à anterior, mas sem dependência de classes Tailwind)
            }
        };

        // --- 5. GEMINI API ---
        APP.GEMINI_HELPER = {
            explain: function(id) {
                const modal = document.getElementById('gemini-modal');
                modal.classList.remove('hidden');
                document.getElementById('gemini-loading').classList.remove('hidden');
                document.getElementById('gemini-modal-content').classList.add('hidden');
                
                // Simulação de chamada (Substituir pela real)
                setTimeout(() => {
                    document.getElementById('gemini-loading').classList.add('hidden');
                    const content = document.getElementById('gemini-modal-content');
                    content.innerHTML = "<p>Esta é uma explicação simulada da IA sobre o erro na questão.</p>";
                    content.classList.remove('hidden');
                }, 1500);
            }
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('load-template-btn').addEventListener('click', APP.UI_RENDERER.insertTemplate);
            document.getElementById('load-quiz-btn').addEventListener('click', APP.QUIZ_MANAGER.loadQuiz);
            document.getElementById('finish-quiz-btn').addEventListener('click', APP.QUIZ_MANAGER.finishQuiz);
            document.getElementById('reset-app-btn').addEventListener('click', APP.UI_RENDERER.resetApp);
            document.getElementById('gemini-modal-close').addEventListener('click', () => document.getElementById('gemini-modal').classList.add('hidden'));
            
            document.getElementById('markdown-input').addEventListener('input', (e) => {
                document.getElementById('load-quiz-btn').disabled = e.target.value.trim() === '';
            });
            
            APP.UI_RENDERER.insertTemplate();
        });
    </script>

    <style>
        /* CSS Padrão (Substituindo Tailwind) */
        .tool-wrapper {
            font-family: 'Montserrat', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .header-section { text-align: center; margin-bottom: 2rem; }
        .main-title { font-size: 2rem; color: var(--primary-dark); font-weight: 800; margin-bottom: 0.5rem; }
        .subtitle { color: #666; font-size: 1.1rem; }

        .content-box {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .box-title { font-size: 1.5rem; color: var(--primary); margin-bottom: 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 0.5rem; }

        .input-area {
            width: 100%;
            height: 300px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        /* Botões */
        .btn { padding: 0.8rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; text-transform: uppercase; font-size: 0.9rem; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-info { background: #3b82f6; color: white; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-full { width: 100%; }
        .btn-xs { padding: 0.3rem 0.6rem; font-size: 0.75rem; text-transform: none; }

        /* Question Card */
        .question-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .question-title { font-weight: 700; color: #333; margin-bottom: 0.5rem; }
        .question-support-text { background: #eef2ff; padding: 1rem; border-left: 4px solid var(--primary); margin-bottom: 1rem; font-style: italic; color: #555; }
        .question-enunciated { margin-bottom: 1rem; font-weight: 500; }
        
        .option-item { margin-bottom: 0.5rem; }
        .option-item input[type="radio"] { display: none; } /* Oculta radio padrão */
        .option-label {
            display: flex;
            padding: 0.8rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
        }
        .option-item input:checked + .option-label {
            border-color: var(--primary);
            background: #eef2ff;
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        }
        .opt-id { font-weight: bold; color: var(--primary); margin-right: 10px; }

        /* Status Bar */
        .status-bar { background: #f3f4f6; padding: 1rem; border-radius: 6px; margin-top: 1rem; text-align: center; font-weight: 600; color: #555; }

        /* Resultados */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .summary-card { padding: 1.5rem; border-radius: 8px; text-align: center; color: white; }
        .summary-card .val { font-size: 2.5rem; font-weight: 800; }
        .bg-primary-light { background: var(--primary); }
        .bg-success-light { background: #10b981; }
        .bg-danger-light { background: #ef4444; }

        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media(max-width: 768px) { .charts-grid { grid-template-columns: 1fr; } }
        .canvas-wrapper { height: 300px; width: 100%; }

        /* Gabarito Table */
        .table-wrapper { overflow-x: auto; }
        .result-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .result-table th, .result-table td { padding: 0.8rem; text-align: left; border-bottom: 1px solid #eee; }
        .result-table th { background: #f9fafb; color: #555; font-weight: 600; }
        .text-success { color: #10b981; }
        .text-danger { color: #ef4444; }
        .bold { font-weight: 700; }

        /* Feedback Visual */
        .status-correct { border-color: #10b981; background: #ecfdf5; }
        .status-incorrect { border-color: #ef4444; background: #fef2f2; }
        .badge-correct { color: #10b981; font-weight: bold; font-size: 0.8rem; margin-left: 5px; }
        .badge-wrong { color: #ef4444; font-weight: bold; font-size: 0.8rem; margin-left: 5px; }

        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-card { background: white; width: 90%; max-width: 600px; padding: 2rem; border-radius: 12px; position: relative; max-height: 80vh; overflow-y: auto; }
        .modal-close { position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; }
        
        /* Utils */
        .hidden { display: none !important; }
        .mt-4 { margin-top: 1rem; }
        .mt-8 { margin-top: 2rem; }
        .mt-12 { margin-top: 3rem; }
        .flex-btn { display: inline-flex; align-items: center; gap: 0.5rem; justify-content: center; }
        .action-buttons-row { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .action-buttons-row .btn { flex: 1; }

        /* Toasts */
        .toast { position: fixed; bottom: 20px; right: 20px; background: #333; color: white; padding: 1rem; border-radius: 8px; opacity: 0; transition: 0.3s; pointer-events: none; }
        .toast.show { opacity: 1; }
        .toast-danger { background: #ef4444; }
        .toast-success { background: #10b981; }
    </style>
</Layout>
