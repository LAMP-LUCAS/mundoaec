<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Gasto de Energia</title>
    <!-- Incluindo Tailwind CSS para estilização fácil e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluindo Chart.js para a visualização do gráfico -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-2xl shadow-xl max-w-xl w-full">
        <h1 class="text-3xl font-bold text-center mb-2 text-indigo-600">Calculadora de Gasto de Energia</h1>
        <p class="text-center text-gray-600 mb-6">Estime o custo mensal e visualize o impacto de cada aparelho.</p>

        <div id="calculator-form" class="space-y-6">
            <!-- Input para a tarifa de energia -->
            <div>
                <label for="kwh-price" class="block text-sm font-medium text-gray-700 mb-1">Custo por kWh (R$)</label>
                <input type="number" id="kwh-price" value="0.75" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
            </div>

            <!-- Seção de aparelhos -->
            <div id="appliances-container" class="space-y-4">
                <!-- Modelo de um aparelho (já com valores de exemplo) -->
                <div class="appliance grid grid-cols-1 md:grid-cols-5 gap-4 items-end bg-gray-100 p-4 rounded-xl shadow-inner">
                    <div class="col-span-1 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Aparelho</label>
                        <select class="appliance-select w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <!-- Opções serão adicionadas via JS -->
                        </select>
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Potência (W)</label>
                        <input type="number" value="150" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 appliance-power">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Uso Diário (h)</label>
                        <input type="number" value="5" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 appliance-hours">
                    </div>
                    <div class="col-span-1 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Quantidade</label>
                        <input type="number" value="1" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 appliance-quantity">
                    </div>
                    <button class="remove-appliance md:col-start-5 md:row-start-1 h-fit bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center self-center md:self-end mt-2 md:mt-0 font-bold hover:bg-red-600 transition duration-200" title="Remover Aparelho">
                        &times;
                    </button>
                </div>
            </div>

            <div class="flex space-x-4">
                <button id="add-appliance-btn" class="flex-1 bg-green-500 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-green-600 transition duration-200">
                    + Adicionar Aparelho
                </button>
                <button id="calculate-btn" class="flex-1 bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-indigo-700 transition duration-200">
                    Calcular Gasto
                </button>
            </div>
        </div>

        <!-- Seção de resultados do consumo -->
        <div id="results" class="mt-8 space-y-4 hidden">
            <h2 class="text-2xl font-bold text-center text-indigo-600">Custo Estimado</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                <div class="bg-indigo-100 p-4 rounded-xl shadow-md">
                    <p class="text-sm text-gray-600">Diário</p>
                    <p id="daily-cost" class="text-xl font-bold text-indigo-700">R$ 0,00</p>
                </div>
                <div class="bg-indigo-100 p-4 rounded-xl shadow-md">
                    <p class="text-sm text-gray-600">Semanal</p>
                    <p id="weekly-cost" class="text-xl font-bold text-indigo-700">R$ 0,00</p>
                </div>
                <div class="bg-indigo-100 p-4 rounded-xl shadow-md">
                    <p class="text-sm text-gray-600">Mensal</p>
                    <p id="monthly-cost" class="text-xl font-bold text-indigo-700">R$ 0,00</p>
                </div>
                <div class="bg-indigo-100 p-4 rounded-xl shadow-md">
                    <p class="text-sm text-gray-600">Anual</p>
                    <p id="yearly-cost" class="text-xl font-bold text-indigo-700">R$ 0,00</p>
                </div>
            </div>

            <!-- Gráfico de visualização de consumo -->
            <div id="chart-container" class="mt-8 p-4 bg-gray-100 rounded-xl shadow-inner hidden">
                <h3 class="text-xl font-bold text-center mb-4 text-gray-700">Consumo por Aparelho (Mensal)</h3>
                <canvas id="consumptionChart"></canvas>
            </div>
        </div>

        <!-- Seção de simulação de geração -->
        <div id="generation-simulation" class="mt-10 space-y-8 hidden">
            <h2 class="text-2xl font-bold text-center mb-4 text-indigo-600">Simulação de Geração de Energia</h2>
            
            <!-- Seção de Geração Solar -->
            <div class="bg-blue-50 p-6 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-blue-700 mb-4">Sistema Solar Fotovoltaico</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Consumo Mensal (kWh)</p>
                            <p id="solar-kwh-monthly" class="text-xl font-bold text-blue-800">0 kWh</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Potência Recomendada</p>
                            <p id="solar-power" class="text-xl font-bold text-blue-800">0 kWp</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Painéis (~550W)</p>
                            <p id="solar-panels" class="text-xl font-bold text-blue-800">0 unidades</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Custo Estimado</p>
                            <p id="solar-cost" class="text-xl font-bold text-blue-800">R$ 0,00</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Valores baseados em insolação média de 5.0 kWh/m²/dia e custo de R$ 4.500/kWp.</p>
                </div>
            </div>

            <!-- Seção de Gerador a Diesel -->
            <div class="bg-gray-50 p-6 rounded-2xl shadow-lg">
                <h3 class="text-xl font-bold text-gray-700 mb-4">Gerador a Diesel</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Consumo Mensal (kWh)</p>
                            <p id="diesel-kwh-monthly" class="text-xl font-bold text-gray-800">0 kWh</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Consumo Mensal de Diesel</p>
                            <p id="diesel-liters" class="text-xl font-bold text-gray-800">0 L</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-inner">
                            <p class="text-sm text-gray-600">Custo Mensal Estimado</p>
                            <p id="diesel-cost" class="text-xl font-bold text-gray-800">R$ 0,00</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Valores baseados em consumo de 0.35 L/kWh e preço do diesel de R$ 6.50/L.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensagem de erro/alerta -->
    <div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white p-6 rounded-lg shadow-2xl max-w-sm w-full text-center">
            <p id="message-text" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="close-message-btn" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition duration-200">OK</button>
        </div>
    </div>

    <script>
        // DOM elements
        const kwhPriceInput = document.getElementById('kwh-price');
        const appliancesContainer = document.getElementById('appliances-container');
        const addApplianceBtn = document.getElementById('add-appliance-btn');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultsSection = document.getElementById('results');
        const dailyCostEl = document.getElementById('daily-cost');
        const weeklyCostEl = document.getElementById('weekly-cost');
        const monthlyCostEl = document.getElementById('monthly-cost');
        const yearlyCostEl = document.getElementById('yearly-cost');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const closeMessageBtn = document.getElementById('close-message-btn');
        const generationSimulationSection = document.getElementById('generation-simulation');
        const solarKwhMonthlyEl = document.getElementById('solar-kwh-monthly');
        const solarPowerEl = document.getElementById('solar-power');
        const solarPanelsEl = document.getElementById('solar-panels');
        const solarCostEl = document.getElementById('solar-cost');
        const dieselKwhMonthlyEl = document.getElementById('diesel-kwh-monthly');
        const dieselLitersEl = document.getElementById('diesel-liters');
        const dieselCostEl = document.getElementById('diesel-cost');
        const chartContainer = document.getElementById('chart-container');
        const consumptionChartCanvas = document.getElementById('consumptionChart');
        let consumptionChart = null; // Variable to hold the chart instance

        // Common appliances data
        const commonAppliances = [
            { name: "Personalizado", power: 0, hours: 0 },
            { name: "Ar-Condicionado (9000 BTU)", power: 1000, hours: 8 },
            { name: "Geladeira (frost-free)", power: 100, hours: 24 },
            { name: "Chuveiro Elétrico", power: 5500, hours: 0.5 },
            { name: "Máquina de Lavar (ciclo completo)", power: 500, hours: 1 },
            { name: "Televisão (LED 42'')", power: 120, hours: 5 },
            { name: "Lâmpada LED (10W)", power: 10, hours: 10 },
            { name: "Micro-ondas", power: 1200, hours: 0.2 },
            { name: "Computador Desktop", power: 250, hours: 8 },
            { name: "Ventilador de Teto", power: 80, hours: 8 }
        ];

        // Function to show a custom message box instead of alert()
        function showMessage(text) {
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('flex');
        }

        // Function to hide the message box
        function hideMessage() {
            messageBox.classList.add('hidden');
            messageBox.classList.remove('flex');
        }

        closeMessageBtn.addEventListener('click', hideMessage);

        // Function to populate the select dropdown with appliance options
        function populateApplianceSelect(selectElement, applianceData) {
            applianceData.forEach(appliance => {
                const option = document.createElement('option');
                option.value = appliance.name;
                option.textContent = appliance.name;
                selectElement.appendChild(option);
            });
        }

        // Function to add a new appliance input block
        function addAppliance(defaultAppliance = commonAppliances[0]) {
            const applianceDiv = document.createElement('div');
            applianceDiv.classList.add('appliance', 'grid', 'grid-cols-1', 'md:grid-cols-5', 'gap-4', 'items-end', 'bg-gray-100', 'p-4', 'rounded-xl', 'shadow-inner');
            applianceDiv.innerHTML = `
                <div class="col-span-1 md:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Aparelho</label>
                    <select class="appliance-select w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- Opções serão adicionadas via JS -->
                    </select>
                </div>
                <div class="col-span-1 md:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Potência (W)</label>
                    <input type="number" value="${defaultAppliance.power}" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 appliance-power">
                </div>
                <div class="col-span-1 md:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Uso Diário (h)</label>
                    <input type="number" value="${defaultAppliance.hours}" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 appliance-hours">
                </div>
                <div class="col-span-1 md:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Quantidade</label>
                    <input type="number" value="1" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 appliance-quantity">
                </div>
                <button class="remove-appliance md:col-start-5 md:row-start-1 h-fit bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center self-center md:self-end mt-2 md:mt-0 font-bold hover:bg-red-600 transition duration-200" title="Remover Aparelho">
                    &times;
                </button>
            `;
            const selectElement = applianceDiv.querySelector('.appliance-select');
            populateApplianceSelect(selectElement, commonAppliances);

            // Set the default selected option
            const selectedOption = selectElement.querySelector(`option[value="${defaultAppliance.name}"]`);
            if (selectedOption) {
                selectedOption.selected = true;
            }

            appliancesContainer.appendChild(applianceDiv);
        }
        
        // Initial appliance
        const firstApplianceSelect = document.querySelector('.appliance-select');
        populateApplianceSelect(firstApplianceSelect, commonAppliances);
        
        const firstAppliance = commonAppliances.find(a => a.name === "Televisão (LED 42'')");
        const firstPowerInput = document.querySelector('.appliance-power');
        const firstHoursInput = document.querySelector('.appliance-hours');
        firstPowerInput.value = firstAppliance.power;
        firstHoursInput.value = firstAppliance.hours;
        firstApplianceSelect.value = firstAppliance.name;

        // Add event listener to the add appliance button
        addApplianceBtn.addEventListener('click', () => addAppliance());

        // Event delegation for appliance select and remove buttons
        appliancesContainer.addEventListener('change', (event) => {
            if (event.target.classList.contains('appliance-select')) {
                const selectedName = event.target.value;
                const selectedAppliance = commonAppliances.find(app => app.name === selectedName);
                const parentDiv = event.target.closest('.appliance');
                if (selectedAppliance) {
                    parentDiv.querySelector('.appliance-power').value = selectedAppliance.power;
                    parentDiv.querySelector('.appliance-hours').value = selectedAppliance.hours;
                }
            }
        });

        appliancesContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-appliance')) {
                if (appliancesContainer.childElementCount > 1) {
                    event.target.closest('.appliance').remove();
                } else {
                    showMessage('Você precisa ter pelo menos um aparelho.');
                }
            }
        });

        // Function to create or update the pie chart
        function updateChart(labels, data) {
            const chartData = {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#4f46e5', '#8b5cf6', '#a855f7', '#d946ef', '#ec4899', '#f43f5e', '#ef4444',
                        '#f97316', '#eab308', '#22c55e', '#10b981', '#06b6d4', '#0ea5e9', '#3b82f6'
                    ],
                    hoverOffset: 4
                }]
            };

            const chartOptions = {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                const total = tooltipItem.dataset.data.reduce((acc, value) => acc + value, 0);
                                const value = tooltipItem.raw;
                                const percentage = ((value / total) * 100).toFixed(1);
                                return ` ${tooltipItem.label}: ${value.toFixed(2)} kWh (${percentage}%)`;
                            }
                        }
                    }
                }
            };

            if (consumptionChart) {
                consumptionChart.data = chartData;
                consumptionChart.update();
            } else {
                consumptionChart = new Chart(consumptionChartCanvas, {
                    type: 'pie',
                    data: chartData,
                    options: chartOptions,
                });
            }
            chartContainer.classList.remove('hidden');
        }

        // Function to perform generation calculations
        function calculateGeneration(monthlyKwh) {
            // CONSTANTS for solar calculation (simplified averages for Brazil)
            const solarIrradiation = 5.0; // kWh/m²/dia
            const systemEfficiency = 0.85; // 85%
            const panelPower = 0.55; // kWp (ex: 550W)
            const costPerKwp = 4500; // R$/kWp (ex: R$4.500)

            // SOLAR CALCULATION
            const dailyKwh = monthlyKwh / 30;
            const requiredKwp = dailyKwh / (solarIrradiation * systemEfficiency);
            const numberOfPanels = Math.ceil(requiredKwp / panelPower);
            const solarInstallationCost = requiredKwp * costPerKwp;

            // Display solar results
            solarKwhMonthlyEl.textContent = `${monthlyKwh.toFixed(0)} kWh`;
            solarPowerEl.textContent = `${requiredKwp.toFixed(2)} kWp`;
            solarPanelsEl.textContent = `${numberOfPanels} unidades`;
            solarCostEl.textContent = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(solarInstallationCost);

            // CONSTANTS for diesel generator calculation
            const dieselConsumptionRate = 0.35; // L/kWh
            const dieselPrice = 6.50; // R$/L

            // DIESEL CALCULATION
            const monthlyDieselLiters = monthlyKwh * dieselConsumptionRate;
            const monthlyDieselCost = monthlyDieselLiters * dieselPrice;

            // Display diesel results
            dieselKwhMonthlyEl.textContent = `${monthlyKwh.toFixed(0)} kWh`;
            dieselLitersEl.textContent = `${monthlyDieselLiters.toFixed(2)} L`;
            dieselCostEl.textContent = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(monthlyDieselCost);

            generationSimulationSection.classList.remove('hidden');
        }

        // Main calculation function
        calculateBtn.addEventListener('click', () => {
            const kwhPrice = parseFloat(kwhPriceInput.value);

            if (isNaN(kwhPrice) || kwhPrice < 0) {
                showMessage('Por favor, insira um valor válido para o custo por kWh.');
                return;
            }

            const appliances = document.querySelectorAll('.appliance');
            let totalDailyKwh = 0;
            let isValid = true;
            const chartLabels = [];
            const chartData = [];

            appliances.forEach(appliance => {
                const powerInput = appliance.querySelector('.appliance-power');
                const hoursInput = appliance.querySelector('.appliance-hours');
                const quantityInput = appliance.querySelector('.appliance-quantity');
                const nameInput = appliance.querySelector('.appliance-select');
                
                const power = parseFloat(powerInput.value);
                const hours = parseFloat(hoursInput.value);
                const quantity = parseInt(quantityInput.value);
                const name = nameInput.value;

                if (isNaN(power) || power < 0 || isNaN(hours) || hours < 0 || isNaN(quantity) || quantity < 1) {
                    showMessage('Por favor, preencha todos os campos com valores válidos e positivos.');
                    isValid = false;
                    return;
                }

                // Calculation: (Watts * Hours) / 1000 = kWh
                const dailyKwh = (power * hours * quantity) / 1000;
                totalDailyKwh += dailyKwh;
                
                // Add data for the chart
                const monthlyKwh = dailyKwh * 30;
                chartLabels.push(name);
                chartData.push(monthlyKwh);
            });

            if (!isValid) {
                resultsSection.classList.add('hidden');
                generationSimulationSection.classList.add('hidden');
                chartContainer.classList.add('hidden');
                return;
            }

            if (totalDailyKwh > 0) {
                const monthlyKwh = totalDailyKwh * 30; // 30 dias por mês
                const dailyCost = totalDailyKwh * kwhPrice;
                const weeklyCost = dailyCost * 7;
                const monthlyCost = dailyCost * 30;
                const yearlyCost = dailyCost * 365;

                // Format and display results
                const formatter = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL',
                });

                dailyCostEl.textContent = formatter.format(dailyCost);
                weeklyCostEl.textContent = formatter.format(weeklyCost);
                monthlyCostEl.textContent = formatter.format(monthlyCost);
                yearlyCostEl.textContent = formatter.format(yearlyCost);

                resultsSection.classList.remove('hidden');

                // Call functions to update the chart and generation simulation
                updateChart(chartLabels, chartData);
                calculateGeneration(monthlyKwh);
            } else {
                 resultsSection.classList.add('hidden');
                 generationSimulationSection.classList.add('hidden');
                 chartContainer.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
